<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="949.35">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
  </style>
</head>
<body>
<p class="p1"><b>f02. FTM Basics — ftm.mess</b></p>
<p class="p2"><br></p>
<p class="p3"><b>ftm.mess Does More than Send Messages</b></p>
<p class="p2"><br></p>
<p class="p3">The <b>ftm.mess</b> object <img src="images/f02-01.jpg" alt="f02-01.jpg"> is the FTM version of the Max <b>message box</b>. It looks similar to it, and it does send messages, but it can do many more things besides. It incorporates capabilities similar to those of the <b>expr</b> object (but with access to even more operations and functions than <b>expr</b> provides), and is a sort of <b>send/receive</b> object in the sense that it can remotely access and modify data that is stored in FTM data structures. The combination of all these capabilities in one object is so powerful that you can actually write pretty involved portions of a program in a single <b>ftm.mess</b>.</p>
<p class="p2"><br></p>
<p class="p3">This tutorial patch shows a few of the most basic of these capabilities. All of the message boxes in this patch are <b>ftm.mess</b> objects rather than Max <b>message box</b>es; in these tutorials we'll always use <b>ftm.mess</b> objects when communicating with FTM objects. In the upper left corner of the patch are two examples that demonstrate that for ordinary Max messages, the <b>ftm.mess</b> object works pretty much the same as a <b>message box</b>.</p>
<p class="p2"><br></p>
<p class="p3">• Click on the first two messages and you'll see that the messages that come out are just as you would expect from a <b>message box</b>. All the rest of the <b>ftm.mess</b> objects in this patch show some special capabilities that the <b>message box</b> does not have.</p>
<p class="p2"><br></p>
<p class="p3"><b>Evaluation of Expressions and Functions</b></p>
<p class="p2"><br></p>
<p class="p3">The most important feature of <b>ftm.mess</b> is that parentheses instruct the object to evaluate the operations or functions contained within them, and then send out the returned result. For example, when you click on the message <i>(4 + 5.99)</i> <b>ftm.mess</b> treats the + sign not just as a <i>symbol</i>, as would be the case with a <b>message box</b>, but rather as a math <i>operator</i>. It performs the operation in question and returns the result, and sends it out the outlet.</p>
<p class="p2"><br></p>
<p class="p3">Another feature of <b>ftm.mess</b> is that it can have multiple inlets for providing <i>$</i> arguments to the object, and those inlets can optionally be set to all trigger output, rather than the default case of only the left inlet triggering output. The number of inlets and the triggering of the inlets are set in the object's Inspector.</p>
<p class="p2"><br></p>
<p class="p3">• Use the <b>number box</b>es to enter numbers for the two operands of the expression <i>($1 * $2)</i>. You'll notice that the expression is evaluated and the result is sent out whenever a number comes in either inlet; that's because the object has been set to be triggered by all its inlets.</p>
<p class="p2"><br></p>
<p class="p3">It's worth noting that the white space around the math operators is important for separating the operator from its arguments. (This is different from the Max <b>expr</b> object, in which white space is ignored.) In general each argument, operator, or function name in an <b>ftm.mess</b> should be separated from others by a white space.</p>
<p class="p2"><br></p>
<p class="p3"><b>ftm.mess</b> provides all the operators one would expect in any programming language, with a format similar to the Max <b>expr</b> object, including math operators, logical operators, and bitwise operators.</p>
<p class="p2"><br></p>
<p class="p3">The next example shows that in addition to those operators <b>ftm.mess</b> provides access to a large number of functions for more advanced math operations, complex math, trigonmetric functions, and various conversion functions. (See the <b>ftm.mess</b> help file for a complete listing.) It also demonstrates some of the other features that can be set in the Inspector, such as initial values for the inlet arguments, and variables that are local (and persistent) within that object. In this object, for example, an initial value is provided for t, A, and f (that is, for the arguments <i>$1</i>, <i>$2</i>, and <i>$3</i>) before any number comes in those inlets, and an internal private variable is created named <i>twopi</i>, set to the value of 2π, 6.283185. (It actually acts as a constant value rather than a variable in this case, since it will never be changed, but it serves to make the expression in the message a bit clearer.) Because the initial value for <i>$3</i> is 0.25, when time values are supplied in the left inlet the evaluated result will output floats that describe a sinusoid with a frequency of 1/4 Hz.</p>
<p class="p2"><br></p>
<p class="p3">• Click on the <b>toggle</b> to turn on the <b>clocker</b> object. You can alter the behavior by changing the values for A and f. (Note that because the <b>clocker</b> is outputting at a rate of 20 Hz, the Nyquist frequency of this example is 10 Hz.)</p>
<p class="p2"><br></p>
<p class="p3">The <b>ftm.mess</b> object below that scales the result by 64, adds 64 to it, and trunctates it (removes the fractional part) so that the simple harmonic motion can be displayed by an ordinary Max <b>slider</b>.</p>
<p class="p2"><br></p>
<p class="p3"><b>Accessing Objects and their Methods</b></p>
<p class="p2"><br></p>
<p class="p3">In addition to accessing mathematical operators and functions, <b>ftm.mess</b> can in fact access any functions or methods of FTM objects.</p>
<p class="p2"><br></p>
<p class="p3">• Click on the message <i>($array128 fill $mtof)</i>. Now double-click on the <b>fmat</b> object named <i>array128</i> to open its display window. You will see a list of 128 numbers; these are the frequencies, in Hertz, associated with each of the 128 MIDI note numbers 0 to 127.</p>
<p class="p2"><br></p>
<p class="p3">Let's analyze this message. You will note that the entire message is enclosed in parentheses, and thus will ultimately be evaluated and will output the returned result. However, the outlet of this <b>ftm.mess</b> is not connected to anything, so the message doesn't go anywhere. Nevertheless, the message gets evaluated. Within the parentheses are three items. Those items are a reference to the name of a <b>fmat</b> (a matrix of<span class="Apple-converted-space">  </span>floats), a method understood by <b>fmat</b>, and a reference to the name of an <b>expr</b> (an expression to be evaluated). The first and last are classes of <b>ftm.object</b>. (We introduced <b>fmat</b> in the previous chapter.) The middle one, <i>fill</i>, is a method of the <b>fmat</b> class—a task that it knows how to perform. So the message just says, in effect, "Find the matrix and fill it with this." (However, the "this" is not just a single number in this case, but instead is an expression.)</p>
<p class="p2"><br></p>
<p class="p3">You can see that the patch contains two <b>ftm.object</b>s—an <b>fmat</b> named <i>array128</i> (that has 128 rows and 1 column) and an <b>expr</b> named <i>mtof</i>. A <b>ftm.mess</b> can access the contents of those objects by using a <i>$</i> reference to their names. The <i>fill</i> method to a <b>fmat</b> causes that <b>fmat</b> to be filled with whatever is specified by the following argument. That might be a number, or it might be a <i>$</i> argument referring to a number that came in an inlet of the <b>ftm.mess</b>, or it might be a <i>$</i> variable referring to a private variable of the <b>ftm.mess</b>; in those cases all the cells of the matrix would be filled with the same value. However, the argument to <i>fill</i> might also be a <i>$</i> reference to <i>any</i> FTM object, including an expression to be evaluated. In this case it is a reference to the <b>expr</b> <i>mtof</i>—the expression <i>(midi2hz $row)</i>. (It's contained within single quotes so that it will be treated as a single thing by other objects.) That expression uses the FTM <i>midi2hz</i> function with a <i>$</i> argument that refers to the number of each row of the <b>fmat</b> that is being filled.) The expression says, in effect, "Take the row number and treat it as if it were a MIDI number and convert that number to the corresponding frequency." Since the expression is being evaluated by the <i>fill</i> method of an <b>fmat</b>, the <i>$row</i> reference is understood to mean the row number of that <b>fmat</b>; <i>fill</i> evaluates the expression for each cell of the matrix and puts the returned result into that cell.</p>
<p class="p2"><br></p>
<p class="p3">The above description may seem a bit complicated, but that's only because each of the items in the message refers to a moderately complicated thing (a matrix, a method, and an expression). Within parentheses, each item might be a reference to a matrix or an expression or a function or a method (or any of a variety of other FTM objects), and it might even be another pair of parentheses that needs to be evaluated before the outer pair of parentheses can be evaluated. This use of parentheses within parentheses is referred to as "nested parentheses", a concept common in mathematics and object-oriented programming. To understand such an expression, you have to evaluate each level of parentheses in turn. For a programmer, this is a powerful tool, because it allows the nesting of one procedure within another, thus enabling the construction of arbitrarily elaborate commands.</p>
<p class="p2"><br></p>
<p class="p3">It might also help to remember that every function or method "returns" (sends back) something to the object that called it. When the <b>fmat</b> is done running its <i>fill</i> method is done, <i>fill</i> returns a reference to the object. You can think of that returned reference as being the evaluated value of what is contained within the parentheses. That is what the what the <b>ftm.mess</b> sends out its outlet (if the outlet is connected to another object).</p>
<p class="p2"><br></p>
<p class="p3">The next message in the patch is much simpler. <i>($array128 zero)</i> just means "Find the <i>array128 </i>object and run its <i>zero</i> method.) Since <i>array128</i> is the name of a <b>fmat</b>, and <b>fmat</b>'s <i>zero</i> method fills all cells of the <b>fmat</b> with the number 0, the result is straightforward.</p>
<p class="p2"><br></p>
<p class="p3">• Click on the message <i>($array128 zero)</i> and observe the result in the <i>array128</i> display window.</p>
<p class="p2"><br></p>
<p class="p3">Note that each of these last two messages involved methods that alter the contents of the called object. This remote in-place modification of data results in the loss of whatever data was there previously. (It's comparable to two different Jitter objects writing into the same named matrix.)</p>
<p class="p2"><br></p>
<p class="p3">The <b>fmat</b> and the <b>expr</b> in these two preceding examples are what is called "statically created" FTM objects. They will continue to exist in memory as long as the patch is open (although they can be altered in all sorts of ways). However, we may occasion want to create an object on the fly just long enough to use its information, and then free its space in memory. That's called "dynamic creation". The <b>ftm.mess</b> object can, if need be, create new internal FTM objects, because those object classes have a "new" method that creates a new instance of their class.</p>
<p class="p2"><br></p>
<p class="p3">• Click on the <b>ftm.mess</b> in the lower-left corner of the patch, and observe what is printed in the Max console window. The result that comes out of the outlet is a reference to a dynamically-created matrix, and its contents are the same as we produced earlier in the <i>array128</i> <b>fmat</b>. In this case, though, the message created a new expression and a new matrix on the fly and returned the result of the <i>fill</i> method (a reference to the filled matrix). The reference is what the <b>ftm.mess</b> sends out, and <b>ftm.print</b> looks at that place in memory and prints the contents of the matrix.</p>
<p class="p2"><br></p>
<p class="p3"><b>Further Examples, Interfacing with Max Obects</b></p>
<p class="p2"><br></p>
<p class="p3">The two examples on the right side of the patch show some more methods and show some ways that <b>ftm.mess</b> might be useful in the context of a Max patch.</p>
<p class="p2"><br></p>
<p class="p3">The upper example has several levels of nested parentheses. We can understand how it works by starting to evaluate the lowest level of parentheses. The part that reads <i>'($row / 127.)'</i> states an expression that will divide each row number by 127. That expression gets contained in an instance of the <b>expr</b> class that is created on the fly by a <i>new</i> method: <i>(new expr '($row / 127.)')</i>. That expression is used in a fill method by the fmat named array128: <i>($array128 fill (new expr '($row / 127.)'))</i>. The <i>fill</i> method returns a reference to the <b>fmat</b> <i>array128</i>, and that matrix is used as the left operand in a <i>pow</i> function, which takes the value of its left operand to the power of its right operand. Since its left operand is a matrix and its right operand is the <i>$1</i> argument (the number that comes in the left inlet), it will raise the value of every cell of the matrix to the power of whatever exponent comes in the inlet. In addition to filling the <b>fmat</b>—which you can verify by looking in its display window—the <i>fill</i> method returns a reference to that matrix. That reference is used as the argument to a list function, which returns a list consisting of the contents of its argument (the matrix). Since that list is the thing that is returned by the outermost set of parentheses in the message, that is what <b>ftm.mess</b> sends out, and we use that <i>list</i> message to set the contents of a Max <b>multislider</b> object.</p>
<p class="p2"><br></p>
<p class="p3">• Enter a number in the <b>number box</b> labeled "exponent" to trigger the <b>ftm.mess</b>. In effect, the message creates an expression, uses that expression to fill the <i>array128</i> matrix with a linear progression of 128 values going from 0 to 1, raises those values to the power of whatever exponent came in its inlet, and then sends those values out as a <i>list</i>. After all that, the matrix will contain 128 values describing an exponential curve from 0 to 1, and identical values will be contained and displayed in the <b>multislider</b>. Try different numbers from 0 to 1 and from 1 to 10 to see various curves.</p>
<p class="p2"><br></p>
<p class="p3"><b>The Comma, the Semicolon, and Private Variables</b></p>
<p class="p2"><br></p>
<p class="p3">The last example uses a well-known chaos formula to generate MIDI notes. It's an example of an iterative formula, one in which the result is repeatedly put back into the formula in place of one of the variables. We use a metro object to trigger calculation of the formula repeatedly ten times per second. The chaos formula itself generates a number between 0 and 1, and we map that number into the range of integers from<span class="Apple-converted-space">  </span>36 to 96 for use as MIDI pitch values.</p>
<p class="p2"><br></p>
<p class="p3">The <b>ftm.mess</b> actually contains two separate messages. The first message uses a private variable <i>x</i> (initialized to a value of 0.1 in the Inspector) to calculate an integer value from 36 to 96, and sends it out. The second message uses the formula (1-x)xr, where r is actually the <i>$2</i> argument (initialized to 3.58 in the Inspector) to calculate a new value, and assigns that value to the private <i>x</i> variable. The two messages are separated by a comma, and the second message is followed by a semicolon. As you'll recall from the previous tutorial, this means that the ftm.mess will send out its output after evaluating the first message, but not after evaluating the second one.</p>
<p class="p2"><br></p>
<p class="p3">• Click on the <b>toggle</b> above the <b>metro</b> to start triggering messages. Changing the number that goes in the right inlet will change the <i>$2</i> argument and thus change the chaotic behavior of the iterative formula. For example, an r value of 3.43 will cause extreme attraction to two particular x values. An r value of 3.50 will cause a regular pattern of four x values. An r value of 3.55 will cause a regular pattern of eight x values. An r value of 3.60 creates a pattern of high and low values that varies in details of its length and actual x values. And an r value of 3.7 will cause a variable longer pattern with occasional surprise repetitions of a single x value.</p>
<p class="p2"><br></p>
<p class="p3">This patch uses four methods of displaying the output of the iterative formula—a keyboard <b>kslider</b>, a <b>number box</b>, a <b>multislider</b> in Point Scroll mode, and MIDI notes played on a synthesizer with <b>noteout</b>.</p>
<p class="p2"><br></p>
<p class="p3"><b>Summary</b></p>
<p class="p2"><br></p>
<p class="p3">In the <b>ftm.mess</b> object one uses parentheses to access math operators and functions. The object evaluates the result of the operation or function and sends out the returned result. Parentheses can be nested. The object can have multiple inlets, and can have initialized values and private variables, set in the Inspector. The $ can be used to access inlets and private variables as well as to reference ay other FTM object. By using parentheses and $ references, one can access any of the methods of other FTM objects and include the returned results of those methods in the message. Messages can be concatenated in a single <b>ftm.mess</b>, separated by a comma or a semicolon; messages separated by a semicolon will be evaluated but will not cause output. By combining multiple messages, nested parentheses, and references to other FTM objects, one can construct fairly elaborate processes within a single <b>ftm.mess</b>.</p>
</body>
</html>
